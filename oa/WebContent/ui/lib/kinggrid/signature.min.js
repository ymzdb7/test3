var $jscomp={scope:{},findInternal:function(m,n,h){m instanceof String&&(m=String(m));for(var q=m.length,u=0;u<q;u++){var x=m[u];if(n.call(h,x,u,m))return{i:u,v:x}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(m,n,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");m!=Array.prototype&&m!=Object.prototype&&(m[n]=h.value)};
$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global?global:m};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(m,n,h,q){if(n){h=$jscomp.global;m=m.split(".");for(q=0;q<m.length-1;q++){var u=m[q];u in h||(h[u]={});h=h[u]}m=m[m.length-1];q=h[m];n=n(q);n!=q&&null!=n&&$jscomp.defineProperty(h,m,{configurable:!0,writable:!0,value:n})}};
$jscomp.polyfill("Array.prototype.find",function(m){return m?m:function(n,h){return $jscomp.findInternal(this,n,h).v}},"es6-impl","es3");
(function(m,n,h){function q(a){a=JSON.stringify(a);return x?a.replace(/\\u([0-9a-fA-F]{2,4})/g,function(a,c){return String.fromCharCode(parseInt(c,16))}):a}function u(a,b){var c=[],d={},f;for(f in a){var l={},p=a[f];g.is("String",p)&&(x||0!=p.indexOf("ey"))?(l["b64_"+f]=a[f],c.push(l)):d[f]=p}var r=[];(function(a){for(var b in a)r.push((new e(b,a[b])).load(e.options))})(d);if(d=c.length)for(f=e.options.signSize||5,l=Math.ceil(d/f),p=1;p<=l;p++)L.request(e.options.b64Url,c.slice(f*(p-1),f*p>d?d:f*
p)).ret(function(a){if(a.result)for(var b in a){if(0==b.indexOf("b64_")){var c=a[b];g.is("String",c)&&(c=JSON.parse(c));r.push((new e(b.substring(4),c)).load(e.options))}}else e.prototype.warning.call(null,a)});L.fin(function(a,c,d){b&&b(1==r.length?r[0]:r)})}var x=!1;m.JSON&&(x='{"x":"\u4e2d"}'!==m.JSON.stringify({x:"\u4e2d"}));var F=!0;try{m.document.createElement("canvas").getContext("2d")}catch(a){F=!1}var g=n.Utils,E=h(window),C=h(document),v=document.documentElement,J=!!("minWidth"in v.style)&&
"onlosecapture"in v,k="setCapture"in v,w,z,B=function(a){w&&(a=a.originalEvent?a.originalEvent.touches.item(0):a.touches.item(0));return a},K=function(a){this.start=h.proxy(this.start,this);this.over=h.proxy(this.over,this);this.end=h.proxy(this.end,this);this.onstart=this.onover=this.onend=h.noop;z||(w="mousedown"!=a.type,z={start:w?"touchstart":"mousedown",over:w?"touchmove":"mousemove",end:w?"touchend":"mouseup"})};K.prototype={start:function(a){a=this.startFix(a);D.trigger("dragStart",this,a);
C.on(z.over,this.over).on(z.end,this.end);this.onstart(a);return!1},over:function(a){a=this.overFix(a);D.trigger("dragOver",this,a);this.onover(a);return!1},end:function(a){a=this.endFix(a);D.trigger("dragEnd",this,a);C.off(z.over,this.over).off(z.end,this.end);this.onend(a);return!1},startFix:function(a){a=B(a);this.target=h(a.target);this.selectstart=function(){return!1};C.on("selectstart",this.selectstart).on("dblclick",this.end);if(J)this.target.on("losecapture",this.end);else E.on("blur",this.end);
k&&this.target[0].setCapture();return a},overFix:function(a){return a=B(a)},endFix:function(a){a=B(a);C.off("selectstart",this.selectstart).off("dblclick",this.end);J?this.target.off("losecapture",this.end):E.off("blur",this.end);k&&this.target[0].releaseCapture();return a}};K.create=function(a,b,c){var d=h(a),f=new K(b),l=z.start,e=function(){},r=a.className.replace(/^\s|\s.*/g,"")+"-drag-start",k=d[0].style,A,M,g,w,n=0,m=0,B=parseInt(k.left),t=parseInt(k.top),v=B,u=t,q=B,x=t;c&&(v=parseInt(k.marginLeft),
u=parseInt(k.marginTop),q=v,x=u);var y={onstart:e,onover:e,onend:e,off:function(){d.off(l,f.start)}};f.onstart=function(b){var c="fixed"===d.css("position"),f=C.scrollLeft(),l=C.scrollTop(),e=d.width(),p=d.height();M=A=0;g=c?E.width()-e+A:C.width()-e;w=c?E.height()-p+M:C.height()-p;p=d.offset();e=this.startLeft=c?p.left-f:p.left;c=this.startTop=c?p.top-l:p.top;this.clientX=b.clientX;this.clientY=b.clientY;p=d.parent();p.is("body")||(n=p[0].getBoundingClientRect().left+f,m=p[0].getBoundingClientRect().top+
l);d.addClass(r);y.onstart.call(a,b,e,c)};f.onover=function(b){var f=b.clientX-this.clientX+this.startLeft,e=b.clientY-this.clientY+this.startTop,l=d[0].style,f=Math.max(A,Math.min(g,f)),e=Math.max(M,Math.min(w,e));c?(f=l.marginLeft=f-n-B+"px",e=l.marginTop=e-m-t+"px"):(f=l.left=f-n+"px",e=l.top=e-m+"px");q=parseInt(f);x=parseInt(e);y.onover.call(a,b,f,e)};f.onend=function(b){var f=d.position(),e=f.left,f=f.top;d.removeClass(r);var l=d[0].style,p=!0;6>Math.abs(q-v)&&6>Math.abs(x-u)&&(p=!1);c?y.onend.call(a,
b,p,l.marginLeft,l.marginTop):y.onend.call(a,b,p,e,f)};f.off=function(){d.off(l,f.start)};if(b)f.start(b);else d.on(l,f.start);return y};var v=n.Listener,G=function(){};h.extend(G.prototype,v.prototype);var y=function(){};y.className=y.name||"SealService";g.inherit(y,G);h.extend(y.prototype,{loadSeal:function(){throw Error("must impl");},saveLog:function(){},verifyPwd:function(){throw Error("must impl");}});var H=function(){};H.className=H.name||"CertService";g.inherit(H,G);h.extend(H.prototype,{sign:function(){throw Error("must impl");
},verifySign:function(){throw Error("must impl");}});G=function(){};h.extend(G.prototype,{getAttr:function(a){return this[a]},setAttr:function(a){var b=this;h.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})},removeAttr:function(a){delete this[a]}});var e=function(a,b){var c=this;c.signatureid=a;c.setSignatureData(b);c.on("load",function(){e.list[a]=this});c.on("remove",function(a){a=c._getLogInfo(g.extend(a||{},{LOGTYPE:"00",LOGSORT:"14",LOGMEMO:"\u64a4\u9500\u7b7e\u7ae0\u6210\u529f"}));
c.sealService.saveLog(a);delete e.list[c.signatureid]});c.on("update",function(a){"signMeta"===c._item&&(a=c._getLogInfo(g.extend(a||{},{LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"})),c.sealService.saveLog(a))});c.on("fireremove",function(){e.removeList.push(c.signatureid)});c.on("fireupdate",function(){for(var a=!1,b=0;b<e.updateList.length;b++)if(e.updateList[b]===c){a=!0;break}a||e.updateList.push(c)});for(var d in e)e.hasOwnProperty(d)&&0==d.indexOf("on")&&(this[d]=
e[d]);return this},N=function(a,b,c){var d;if(F){d=m.document.createElement("canvas");d.height=c;d.width=b;var f=d.getContext("2d"),e=new Image;e.src=a;e.onload=function(){f.drawImage(e,0,0,b,c)}}else d=m.document.createElement("img"),d.style.width=b+"px",d.style.height=c+"px",d.setAttribute("src",a);return d};g.inherit(e,G);h.extend(e.prototype,v.prototype);h.extend(e.prototype,{hashAlg:"sha1",encryptAlg:"RSA",_init:function(){},_getLogInfo:function(a){var b=this.signatureData;return g.extend(a||
{},{KEYSN:b.keysn,SIGNSN:b.seal.signsn,DOCUMENTID:b.documentid,DOCUMENTNAME:b.documentname,APPVERSION:O.name,APPTYPE:"HTML"})},warning:function(a){var b=a;g.is("Object",a)&&(b=a.errcode&&"511"!=a.errcode?a.errcode:a.errmsg);b||(b="\u91d1\u683c\u7ec4\u4ef6\u672a\u77e5\u9519\u8bef");var c=g.is("String",arguments[1])?c:"then",d=arguments[arguments.length-1];t.alert(n.msg(b,c),function(){t.hideLoading();return g.is("Function",d)?d():!0})},error:function(a,b,c){var d=a;g.is("Object",a)&&(d=a.errcode&&
"511"!=a.errcode?a.errcode:a.errmsg);d||(d="\u91d1\u683c\u7ec4\u4ef6\u672a\u77e5\u9519\u8bef");b=g.is("String",b)?b:"then";t.alert(n.msg(d,b),function(){t.hideLoading();return g.is("Function",c)?c():!0})},load:function(a){this.trigger("beforeLoad");this.setAttr(a);this.certService=new e.factory.cert[e.options.certType](a,this.signatureData);var b=this.signatureData;void 0!==a.extra&&null!==a.extra&&void 0!==a.extra[this.signatureid]&&void 0!==a.extra[this.signatureid].scaleImage&&null!==a.extra[this.signatureid].scaleImage?
(b.seal.height*=a.extra[this.signatureid].scaleImage,b.seal.width*=a.extra[this.signatureid].scaleImage):void 0!==a.scaleImage&&null!==a.scaleImage&&(b.seal.height*=a.scaleImage,b.seal.width*=a.scaleImage);this.sealService=new e.factory.seal[e.options.sealType](a,b);this._init();this.trigger("load");return this},toBase64Img:function(a){var b=a.imgdata,c=b.indexOf(a.signsn);if(-1==c)return b;b=a.imgdata.substring(c+65);return g.Base64.of().encodeByte(g.Base64.of(a.signsn).decodeByte(b))},clearImg:function(){if(this.imgEles)for(var a in this.imgEles)this.trigger("removeAt",
this.imgEles[a][0]),this.imgEles[a].remove();this.imgEles={}},repaint:function(){this.clearImg();this.verify()},getUpdateType:function(){return this._item},updatePos:function(a,b){var c=this.signatureData.position[a];this._item="position";this.signatureData.position[a]=g.extend({},c,b)},updateItem:function(a,b){this._item=a;this.signatureData[a]=b},fireUpdate:function(a){var b=this,c=function(c){a&&a(c);b[c?"update":"restore"]();delete b._item};e.asyn.update?e.asyn.update.call(b,c):(this.trigger("fireupdate"),
c(!0));return this},restore:function(){this.setSignatureData(this.oriSignatureData);this.repaint()},update:function(){this.setSignatureData(this.signatureData);this.repaint();this.trigger("update");return this},remove:function(){this.clearImg();this.trigger("remove");for(var a in this)delete this[a];return this},fireRemove:function(a){var b=this,c=function(c){a&&a(c);c&&b.remove()};e.asyn.remove?e.asyn.remove.call(b,c):(this.trigger("fireremove"),c(!0));return this},hide:function(){if(this.imgEles)for(var a in this.imgEles)this.imgEles[a].hide()},
createImg:function(){var a=this.signatureData,b=h(document.createElement("img")),c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=";this.broken||(c="data:image/"+a.seal.imgext+";base64,"+this.toBase64Img(a.seal));b.css({width:Math.ceil(9600*parseFloat(a.seal.width)/254),height:Math.ceil(9600*parseFloat(a.seal.height)/254)}).attr({src:c});return b},show:function(){var a=this.signatureData.position,b=this.imgEles=this.imgEles||{},c;
for(c in a){var d="kg-img-div-"+this.signatureid+"-"+c,f=b[d];f||(f=b[d]=this.showAt(c,a[c]));this._handleImg(f)}this.trigger("show")},showAt:function(a,b){this.trigger("beforeShowAt",a,b);var c=g.$(a),d=h(c);if(0==d.length)if(e.options.defaultPos)a=e.options.defaultPos,d=h(g.$(a));else throw Error("no find position:"+a+" signatureid="+this.signatureid);var f=this.createImg();f.addClass("kg-img").attr("id","kg-img-"+this.signatureid);c=h(document.createElement("div")).addClass("kg-img-div").addClass("kg-img-div-"+
a).attr({id:"kg-img-div-"+this.signatureid+"-"+a,elemid:a,signatureid:this.signatureid});c.append(f);c.css({width:f.width(),height:f.height()});f=this.signatureData.dateTime;null!=f&&f.isCheck&&f.fontDate&&this.addDateToImg(f.fontDate,this.signatureData.timestamp.time,c);var f=c,l="kg-default",p,r=d.attr("display");if(r)d.addClass("display-"+r),l="kg-"+r,p=d,f=document.getElementById("kg-img-container-"+a),f||(f=document.createElement("div"),f.setAttribute("id","kg-img-container-"+a)),f=h(f).addClass(l+
"-container"),f.append(c),c.attr("kg-display",!0);else if(p=d.offsetParent(),"html"==p[0].tagName.toLowerCase()||"relative"==p[0].style.position)p=h("body");c.addClass(l);p.append(f);if(r){if("landscape"===r){var d=f.children(),l=f.parent().width(),k=0;d.each(function(){k+=parseInt(h(this).width())+1});f.width(k>l?k:l)}}else this.calSealPos(d,c,f,b);this.trigger("showAt",c[0],a,b);return c},calSealPos:function(a,b,c,d){var f=a.offsetParent();c=c||b;if("html"==f[0].tagName.toLowerCase()||"relative"==
f[0].style.position)f=h("body");a=a.offset();var e=f.offset();f.is("body")&&(e={top:0,left:0});c.css({top:a.top-e.top,left:a.left-e.left});d?(f=d.marginLeft,d=d.marginTop):(f=b.css("marginLeft"),d=b.css("marginTop"));b.css({marginLeft:f||0,marginTop:d||0})},addDateToImg:function(a,b,c){b=n.Utils.formatDate(new Date(b),a.fontFormat);var d=h(document.createElement("div")).addClass("kg-date"),f=0,e=0;"outside"==a.fontPosition[2]&&("right"==a.fontPosition[3]?f+=c.width():"left"==a.fontPosition[3]&&(f-=
c.width()),"below"==a.fontPosition[4]&&(e+=c.height()));d.css({width:c.width(),height:c.height(),top:e,left:f});f=h(document.createElement("div")).addClass("kg-date-tmb").css({width:c.width()});e=h(document.createElement("div")).addClass("kg-date-lcr").css({"text-align":a.fontPosition[0],"font-family":a.fontFamily,"font-size":a.fontSize+"px",color:a.fontColor});"bottom"==a.fontPosition[1]?f.css({bottom:0}):"middle"==a.fontPosition[1]&&e.css({"line-height":c.height()+"px"});e.html(b);f.html(e);d.html(f);
c.append(d)},canSign:function(){return!this.modified&&!e.options.readonly&&e.options.signable&&!this.signatureData.signMeta},canMove:function(a){return!e.options.readonly&&this.signatureData.moveable&&e.options.moveable&&!h(a).attr("kg-display")},canDelete:function(){return!e.options.readonly},_handleImg:function(a){a.show();if(0==a.children(".kg-shade").length){var b=h(document.createElement("div")).addClass("kg-shade");b.append(N("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=",
a.width(),a.height()));a.append(b)}this._invalid(a);this.trigger("handleImg",a[0])},setSignatureData:function(a){g.is("String",a)?this.signatureData=JSON.parse(g.Base64.of().decode(a)):this.signatureData=a;this.oriSignatureData=JSON.parse(JSON.stringify(this.signatureData))},getSignatureid:function(){return this.signatureid},getSignatureData:function(){var a=JSON.stringify(this.signatureData);return g.Base64.of().encode(a)},_invalid:function(a){var b=a.children(".kg-invalid");if(0==b.length){b=h(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid");
a.append(b);var c=a.height()/3;b.css({top:c,height:c});for(var c=c/3,d=a.width(),f=0;3>f;f++){var e=h(document.createElement("div")).height(c);0==f%2&&(e.addClass("kg-invalid-item"),e.append(N("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC",d,c)));b.append(e)}}if(this.modified){c="";for(d=0;d<this.modifiedItems.length;d++)f=this.modifiedItems[d],c+=f.desc+"["+f.field+"]\u7531{"+f.orivalue+"}\u66f4\u6539\u4e3a{"+f.newvalue+"};";a.attr("modified",
c).addClass("error");b.removeClass("kg-hide")}else a.removeAttr("modified").removeClass("error"),b.addClass("kg-hide")},_verify:function(a){this.trigger("before_verify");a=this.verifyProtectedData(a);this.show();this.trigger("_verify");return!a},verify:function(a){this.trigger("beforeVerify");a=this._verify(a);this.trigger("verify");return a},getVerifyProtectedData:function(){for(var a=this.validatedData,b=this.signatureData.protectedData,c={},d=0;d<b.length;d++){var f=b[d],e=f.field,p=a&&a[e];if(!p){var r=
g.$(e);if(r){if(p=r.getAttribute("kg-value")||r.value,void 0===p||null===p)p=r.innerHTML||r.innerText}else p=void 0!=f.name&&null!=f.name?document.getElementById(f.name).value:""}f=g.val(p,this);f=this._formatValue(f);c[e]=f}return c},getH5SignData:function(){var a=this.hashAlg,b=this.encryptAlg,c=CryptoJS.SHA1(this.getSignData()).toString();return[{hashAlg:a,encryptAlg:b,signdata:c}]},verifyProtectedData:function(a){a&&(this.validatedData=a);a=[];for(var b=this.getVerifyProtectedData(),c=this.signatureData.protectedData,
d=0;d<c.length;d++){var f=c[d],e=b[c[d].field];e!==f.value&&a.push({field:f.field,desc:f.desc,orivalue:f.value,newvalue:e})}this.modified=0<a.length;this.modifiedItems=a;return this.modified},verifySignData:function(a){var b=this;t.showLoading();var c=this.certService,d;if(this.signatureData.signMeta.html2sign){c instanceof I||(c=new I(e.options),c.sData=b.signatureData);d=b.getVerifyProtectedData();for(var f=this.signatureData.protectedData,l=[],p=0;p<f.length;p++){var r=f[p],k={},A;for(A in r)r.hasOwnProperty(A)&&
(k[A]=r[A]);k.value=d[r.field];l.push(k)}d=q(l)}else d=this.getValidatedSignData();c.verifySign(h.extend({signeddata:this.signatureData.signMeta.signeddata,crtdata:this.signatureData.signMeta.certinfo.crtdata,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,signdata:d},{successCall:function(c){t.hideLoading();if(!c.errcode){var d=!c.result;d&&b.verify();b.signModified=d}a&&a(c)},errorCall:function(a){b.error(a)}}))},_renderValue:function(a){return a.replace(/\r\n/ig,"<br>")},_formatValue:function(a,
b){var c=a;c&&(c=c.replace(/\r\n/ig,"\n"),c=c.replace(/\n/ig,"\r\n"));return c},getItemVal:function(a){var b;if(b=g.is("String",a)?g.$(a):a)return a=b.tagName.toLowerCase(),"input"===a||"textarea"===a||"select"===a?b.getAttribute("kg-value")||b.value:b.getAttribute("kg-value")||(x?b.innerText:b.textContent);throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},getProtectedData:function(a){var b=this,c=[],d=function(a){var c=g.$(a);if(c){var d={field:a};d.desc=c.getAttribute("kg-desc")||
a;d.value=b.getItemVal(c);return d}throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},f=function(a){if(g.is("String",a))a=d(a);else if(!g.is("Object",a)||!a.field)throw Error("Unsupported protectedItems:"+a.toString);g.is("Function",a.value)&&(a.value=a.value.call(b,a.field,a.desc));a.value=b._formatValue(a.value);return a};if(a)if(g.is("Array",a))for(var e=0,p=a.length;e<p;e++)c.push(f(a[e]));else c.push(f(a));return c},__findSignedData:function(a){if(g.is("String",a))return a.split(";")[0];
if(g.is("Array",a))return a[0];throw Error("error signeddata: "+a);},getValidatedSignData:function(){var a=this.getVerifyProtectedData(),a=q(a),a=g.Base64.of().encode(a);return CryptoJS.SHA1(a).toString()},getSignData:function(a){a=(a||this.signatureData).protectedData;for(var b={},c=0;c<a.length;c++)b[a[c].field]=a[c].value;return g.Base64.of().encode(q(b))},showSignSignatureDialog:function(a){var b={target:g.is("Array",a.target)?a.target:[a.target],title:"\u6570\u5b57\u7b7e\u540d",onShow:function(){var a=
this;setTimeout(function(){a.find("#kg-password").focus()},40)},onOk:function(){var b=this.find("#kg-password");if(!b.val())return t.alert("\u8bf7\u8f93\u5165\u5bc6\u7801\uff01",function(){b.focus()}),!1;a._onOk.call(this,b.val());return!1}};return this.showDialog("signSignatureBtl",b)},signSignature:function(a){var b=this;return b.showSignSignatureDialog({target:b,_onOk:function(c){var d=this,f=b.getH5SignData();b.runSign(f,c,function(c){c.result?b.fireUpdate(function(a){a&&d.remove()}):b.warning(c);
a&&a(c)})}})},showRevokeSignatureDialog:function(a){var b={target:g.is("Array",a.target)?a.target:[a.target],title:"\u64a4\u9500\u7b7e\u7ae0",onShow:function(){var a=this;setTimeout(function(){a.find("#kg-password").focus()},40)},onOk:function(){var b=this.find("#kg-password");if(!b.val())return t.alert("\u8bf7\u8f93\u5165\u5bc6\u7801\uff01",function(){b.focus()}),!1;a._onOk.call(this,b.val());return!1}};return this.showDialog("revokeSignatureBtl",b)},revokeSignature:function(a){var b=this;if(void 0===
e.options.delCallBack||!e.options.delCallBack||e.options.delCallBack(b.signatureid,b.signatureData))return b.showRevokeSignatureDialog({target:b,_onOk:function(c){var d=this;t.showLoading();b.sealService.verifyPwd({pwd:c,keysn:b.signatureData.keysn,successCall:function(c){t.hideLoading();c.result?b.fireRemove(function(a){a&&d.remove()}):b.warning(c);a&&a(c)},errorCall:function(a){b.error(a)}})}})},showDialog:function(a,b){var c=g.is("Array",b.target)?b.target:[b.target],d=g.extend({title:"\u7535\u5b50\u7b7e\u7ae0",
onCancel:b.errCall||function(){t.hideLoading();return!0},content:function(){var b=[e.options.template[a]].concat(c);return g.template.apply(null,b)}},b),d=t.showDialog(a,d);if("showSealsBtl"===a){var f=d.find("#sealTpl-dialog"),l=!1,p=0,r=0,k=0,A=0;f.prevObject[0].onmousedown=function(a){l=!0;a=a||event;p=a.clientX;r=a.clientY;k=parseInt(f.prevObject[0].style.top);A=parseInt(f.prevObject[0].style.left)};f.prevObject[0].onmousemove=function(a){if(l){a=a||event;var b=A+a.clientX-p;a=k+a.clientY-r;0<
b&&0<a&&(f.prevObject[0].style.left=b+"px",f.prevObject[0].style.top=a+"px")}};f.prevObject[0].onmouseup=function(a){l&&(l=!1,A=k=r=p=0)}}return d},runMove:function(a,b,c){var d=this;D.trigger("startMove",d,a,b);b=K.create(b,a,!0);b.onend=function(a,b,e,r){c&&c(b,e,r);D.trigger("endMove",d,a,e,r);b&&(a=h(this),d.updatePos(a.attr("elemid"),{marginLeft:e,marginTop:r}),d.fireUpdate())};a.preventDefault();return b},runSign:function(a,b,c){var d=this,f=d.signatureData;t.showLoading();d.certService.sign({keysn:this.signatureData.keysn,
signsn:this.signatureData.seal.signsn,password:b,signMeta:a,successCall:function(b){t.hideLoading();b.result&&(b.signeddata?(b.certinfo.algName=b.certinfo.algName.toUpperCase(),d.updateItem("signMeta",{hashAlg:a[0].hashAlg,encryptAlg:a[0].encryptAlg,signdata:a[0].signdata,signeddata:d.__findSignedData(b.signeddata),certinfo:b.certinfo})):(b.result=!1,b.errcode="signErr"),f.certType=e.options.certType);c&&c(b)},errorCall:function(a){d.error(a)}})}});var t=kingPlus();e.options=h.extend({b64Url:"/iWebSignature_base64",
imageUrl:"/iWebSignature_image"},n.options,{dialogConfig:{okValue:"\u786e  \u5b9a",cancelValue:"\u53d6  \u6d88",fixed:!0,backdropOpacity:.2,modal:!0},template:{}},window.KGCONFIG);e.addProvider=function(a,b,c){e.factory[a][b]=c};var L;e.init=function(a,b){this.Seals={};g.extend(e.options,a);var c=e.options;c.serverUrl&&(c.b64Url="/signature/b64",c.imageUrl="/signature/image",c.serverUrl+="/rest");L="client"==c.sealType?e.aisleKing=n.surry("http://127.0.0.1:9581","IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319"):
e.aisleKing=n.surry(c.serverUrl||c.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319");var d=c.clientConfig;if(d&&"client"===c.sealType)for(var f in d)e.AXI("SetParamByName","SOFTTYPE",d[f],b);else b&&b();D.trigger("init")};e.factory={cert:{},seal:{}};e.SealService=y;e.CertService=H;e.asyn={};e._create=function(a){var b=this;b.setAttr(a);b.certService=new e.factory.cert[b.certType](a);b.sealService=new e.factory.seal[b.sealType](a);b.on("createSignature",function(a,d,e){a=
[];var c=b._getLogInfo({LOGTYPE:"00",LOGSORT:"13",LOGMEMO:"\u76d6\u7ae0\u6210\u529f",LOGSORTSUBCLASS:"1301"});a.push(g.extend(d||{},c));e&&a.push(b._getLogInfo({LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"}));b.sealService.saveLog(a)});return this};y=function(){};y.prototype=e.prototype;y=new y;e._create.prototype=y;h.extend(y,{keyData:null,sealExpired:function(a,b,c,d,f){var l=this,p=!0;if(void 0===e.options.valid||null===e.options.valid||!1===e.options.valid)return l.certExpired(b,
c,d);if(void 0!==a.endata&&null!==a.endata){var r=a.endata;a=parseInt(c.substr(0,4));f=parseInt(c.substr(5,2));var p=parseInt(c.substr(8,2)),k=parseInt(r.substr(0,4)),A=parseInt(r.substr(5,2)),r=parseInt(r.substr(8,2));a>k?(l.warning({errcode:"11104"}),p=!1):a==k?f>A?(l.warning({errcode:"11104"}),p=!1):f==A?p>r?(l.warning({errcode:"11104"}),p=!1):p=!0:p=!0:p=!0}else return h.ajax({url:e.options.serverUrl+"/key/SealIsExpired",data:{keysn:l.keyData.keysn,year:(new Date).getFullYear(),month:(new Date).getMonth(),
date:(new Date).getDate(),index:f},async:!1,success:function(a){if(a.error)return alert(a.error),!1;if(0==a.result)return l.certExpired(b,c,d);l.warning({errcode:"11104"});return!1},error:function(a){alert(a)}}),!1;return p?l.certExpired(b,c,d):p},certExpired:function(a,b,c){var d=this,f=!1;if(void 0===e.options.valid||null===e.options.valid||!1===e.options.valid)return!0;n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGGetCerInfo","").ret(function(a){var e=
parseInt(b.substr(0,4)),l=parseInt(b.substr(5,2)),k=parseInt(b.substr(8,2));if(a.result){a=a.certinfo.notAfter;var A=parseInt(a.substr(0,4)),g=parseInt(a.substr(4,1)),g=0==g?parseInt(a.substr(5,1)):parseInt(a.substr(4,2)),h=parseInt(a.substr(6,1)),h=0==h?parseInt(a.substr(7,1)):parseInt(a.substr(6,2));e>A?d.warning({errcode:"11103"}):e==A?l>g?d.warning({errcode:"11103"}):l==g?k>h?d.warning({errcode:"11103"}):f=!0:f=!0:f=!0}else alert("\u83b7\u53d6key\u8bc1\u4e66\u5931\u8d25\uff01");void 0!==c&&null!==
c&&c(f)});return f},runHW:function(a,b){var c=this;t.showLoading();"undefined"!=typeof a.imageData&&null!=a.imageData&&(void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(c),c.sealService.loadSeal({data:a.imageData,successCall:function(d){if(d.result&&d.seals){for(var e in d.seals){d.seals=[{width:a.width,height:a.height,imgext:d.seals[e].imgext,signname:a.name,signsn:d.seals[e].signsn,username:d.seals[e].username,imgdata:a.imageData}];break}c.keyData=d;c.showSeals(b)}else c.warning(d)},errorCall:function(a){c.error(a)}}))},
run:function(a){var b=this;b.keyData?b.showSeals(a):(t.showLoading(),void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(b),b.sealService.loadSeal({successCall:function(c){t.hideLoading();c.result?c.seals?c.seals.length&&(b.keyData=c,void 0!==e.options.imgtag&&0!==e.options.imgtag&&void 0===c.ServerTime?void 0!==b.serverUrl&&null!==b.serverUrl?(c={usercode:b.usercode,keysn:b.keyData.keysn,signname:b.signname,authcode:e.authcode},n.surry(b.serverUrl).request("/key/load",c).ret(function(c){c.result?
(b.curDate=c.ServerTime,b.keyData=c,b.showSeals(a)):alert(c.errmsg)}).fail(function(c,e){b.curDate=(new Date).toLocaleString();b.showSeals(a)})):(b.curDate=(new Date).toLocaleString(),b.showSeals(a)):(b.curDate=c.ServerTime,b.showSeals(a))):b.warning({errcode:"11100"}):b.warning(c)},errorCall:function(a){b.error(a)}}));return this},runBatchSignature:function(a){var b=this;b.keyData?b.showSeals(params):(t.showLoading(),void 0!==params.beginCall&&params.beginCall&&params.beginCall.call(b),b.sealService.loadSeal({successCall:function(a){t.hideLoading();
a.result?a.seals?a.seals.length&&(b.keyData=a,void 0!==e.options.imgtag&&0!==e.options.imgtag&&void 0===a.ServerTime?void 0!==b.serverUrl&&null!==b.serverUrl?(a={usercode:b.usercode,keysn:b.keyData.keysn,signname:b.signname,authcode:e.authcode},n.surry(b.serverUrl).request("/key/load",a).ret(function(a){a.result?(b.curDate=a.ServerTime,b.keyData=a,b.showSeals(params)):alert(a.errmsg)}).fail(function(a,c){b.curDate=(new Date).toLocaleString();b.showSeals(params)})):(b.curDate=(new Date).toLocaleString(),
b.showSeals(params)):(b.curDate=a.ServerTime,b.showSeals(params))):b.warning({errcode:"11100"}):b.warning(a)},errorCall:function(a){b.error(a)}}));return this},getSealsByKeysn:function(a,b){var c=this;c.sealService.loadSeal({successCall:function(a){if(a.result){var d=[];if(void 0!==b&&null!=b){for(var e=0;e<a.seals.length;++e)d[e]=c.toBase64Img(a.seals[e]);b(d)}}},errorCall:function(a){c.error(a)}})},loadSeals:function(a){var b=this;b.sealService.loadSeal({successCall:function(b){void 0!==a&&null!==
a&&null!==b&&void 0!==b.seals&&null!==b.seals&&a(b)},errorCall:function(a){b.error(a)}})},runSS:function(a,b){var c=this;if(null!==b)if(c.keyData=b,void 0!==e.options.imgtag&&0!==e.options.imgtag&&void 0===b.ServerTime)if(void 0!==c.serverUrl&&null!==c.serverUrl){var d={usercode:c.usercode,keysn:c.keyData.keysn,signname:c.signname,authcode:e.authcode};n.surry(c.serverUrl).request("/key/load",d).ret(function(b){b.result?(c.curDate=b.ServerTime,c.keyData=b,c.showSeals(a)):alert(b.errmsg)}).fail(function(b,
d){c.curDate=(new Date).toLocaleString();c.showSeals(a)})}else c.curDate=(new Date).toLocaleString(),c.showSeals(a);else c.curDate=b.ServerTime,c.showSeals(a)},formatPos:function(a,b,c){var d={};if(a){var e=function(a){var e=a.elemid;e||(e="body");d[e]=void 0!=b&&void 0!=c?{marginLeft:b,marginTop:c}:g.filter(a,e)};if(g.is("Array",a))for(var l=0;l<a.length;l++)e(a[l]);else g.is("String",a)?d[a]=void 0!=b&&void 0!=c?{marginLeft:b,marginTop:c}:{}:e(a)}else d.body={};return d},execBS:function(){},exec:function(a,
b,c,d,f){var l=this;delete l.signatureData;var k={timestamp:{time:void 0==a.signtime?(new Date).getTime:a.signtime,signtime:void 0==a.showtime?a.signtime:a.showtime},appname:navigator.userAgent,documentid:void 0==a.documentid?l.documentid:a.documentid,documentname:void 0==a.documentname?l.documentname:a.documentname,moveable:g["boolean"](a,"moveable",e.options.moveable),keysn:l.keyData.keysn,orgname:l.keyData.orgname,usercode:l.keyData.usercode,username:l.keyData.username||c.username,seal:c,protectedData:l.getProtectedData(a.protectedItems),
sealType:a.sealType||l.sealType,extparam:a.extparam,ver:e.version,dateTime:a.datetime};l.signatureData=k;l.certService.sData=l.signatureData;l.sealService.sData=l.signatureData;t.showLoading();var r=a.autoCert||l.autoCert,h=function(a){var b=l.signatureData;if(a&&a.position){b.position=a.offsetX&&a.offsetY?l.formatPos(a.position,a.offsetX,a.offsetY):l.formatPos(a.position);b.timeid=(new Date).getTime();var d=(new e(a.signatureid||l.genId(),b)).load(e.options);a.okCall&&(b={name:c.signname,height:c.height,
width:c.width,imgdata:l.toBase64Img(c)},a.isBatchSignature?a.okCall.call(d,function(a){a||d.remove()},a.documentid):a.okCall.call(d,function(b){b?(l.trigger("createSignature",d,a.logMeta,r),d.show()):d.remove()},b));t.hideLoading()}else throw Error("no set position");};if(r){l.getSignData(k);f=l.getH5SignData();if(a.signMeta)f[g.is("Array",a.signMeta)?"concat":"push"](a.signMeta);a.beforeSignCall&&a.beforeSignCall.call(l,f);l.runSign(f,d,function(c){c.result&&h(a);b(c)})}else f?h(a):l.sealService.verifyPwd({pwd:d,
keysn:k.keysn,successCall:function(c){c.result&&h(a);b(c)},errorCall:function(a){l.error(a)}})},showSeals:function(a){var b=this,c={_onOk:function(c,f,l,k){var d=this,p=new t.kgFont(null==d.fontSel?null==b.signdate?{}:b.signdate:d.fontSel);a.datetime={isCheck:d.isCheck,fontDate:p};void 0!=k&&null!=k?(a.signtime=k,a.showtime=n.Utils.formatDate(new Date(k),"yyyy-MM-dd hh:mm:ss"),a.showtime+="(\u670d\u52a1\u5668\u65f6\u95f4)"):(a.signtime=(new Date).getTime(),a.showtime=n.Utils.formatDate(new Date(a.signtime),
"yyyy-MM-dd hh:mm:ss"),a.showtime+="(\u672c\u5730\u65f6\u95f4)");void 0===e.options.valid||null===e.options.valid||!1===e.options.valid?a.batchSignature?b.sealService.verifyPwd({pwd:f,usercode:void 0==a.usercode?"":a.usercode,keysn:b.keyData.keysn,successCall:function(l){if(l.result){for(l=0;l<a.batchSignature.length;++l)a.batchSignature[l].signtime=a.signtime,a.batchSignature[l].showtime=a.showtime,a.batchSignature[l].position=a.position,a.batchSignature[l].autoCert=a.autoCert,a.batchSignature[l].okCall=
a.okCall,a.batchSignature[l].cancelCall=a.cancelCall,a.batchSignature[l].beginCall=a.beginCall,a.batchSignature[l].endCall=a.endCall,a.batchSignature[l].protectedItems=a.protectedItems,a.batchSignature[l].isBatchSignature=!0,b.exec(a.batchSignature[l],function(a){a.result?void 0!==e.options.showNoPW||!0===e.options.showNoPW?d.remove():void 0!==e.options.showSealsDlg&&!0!==e.options.showSealsDlg||void 0==document.getElementById("kg-remenberPwd")||void 0==document.getElementById("kg-remenberPwd").checked||
(b.trigger("execSuccess",d,f,document.getElementById("kg-remenberPwd").checked),d.remove()):b.warning(a)},c,f,!0),void 0!==a.batchSignature[l].endCall&&a.batchSignature[l].endCall&&a.batchSignature[l].endCall.call(b);d.remove()}else b.error(l.errcode)},errorCall:function(a){b.error(a)}}):(b.exec(a,function(a){if(a.result)if(void 0!==e.options.showNoPW||!0===e.options.showNoPW)d.remove();else{if(void 0===e.options.showSealsDlg||!0===e.options.showSealsDlg)a=document.getElementById("kg-remenberPwd").checked,
b.trigger("execSuccess",d,f,a),d.remove()}else b.warning(a)},c,f),void 0!==a.endCall&&a.endCall&&a.endCall.call(b)):void 0!==b.curDate&&null!==b.curDate&&b.sealExpired(c,a,b.curDate,function(l){l?a.batchSignature?b.sealService.verifyPwd({pwd:f,keysn:b.keyData.keysn,successCall:function(l){if(l.result){for(l=0;l<a.batchSignature.length;++l)a.batchSignature[l].signtime=a.signtime,a.batchSignature[l].showtime=a.showtime,a.batchSignature[l].position=a.position,a.batchSignature[l].autoCert=a.autoCert,
a.batchSignature[l].okCall=a.okCall,a.batchSignature[l].cancelCall=a.cancelCall,a.batchSignature[l].beginCall=a.beginCall,a.batchSignature[l].endCall=a.endCall,a.batchSignature[l].protectedItems=a.protectedItems,a.batchSignature[l].isBatchSignature=!0,b.exec(a.batchSignature[l],function(a){a.result?void 0!==e.options.showNoPW||!0===e.options.showNoPW?d.remove():void 0!==e.options.showSealsDlg&&!0!==e.options.showSealsDlg||void 0==document.getElementById("kg-remenberPwd")||void 0==document.getElementById("kg-remenberPwd").checked||
(b.trigger("execSuccess",d,f,document.getElementById("kg-remenberPwd").checked),d.remove()):b.warning(a)},c,f,!0),void 0!==a.batchSignature[l].endCall&&a.batchSignature[l].endCall&&a.batchSignature[l].endCall.call(b);d.remove()}else b.error(l.errcode)},errorCall:function(a){b.error(a)}}):(b.exec(a,function(a){if(a.result){if(void 0===e.options.showSealsDlg||!0===e.options.showSealsDlg)a=document.getElementById("kg-remenberPwd").checked,b.trigger("execSuccess",d,f,a),d.remove()}else b.warning(a)},
c,f),void 0!==a.endCall&&a.endCall&&a.endCall.call(b)):b.warning({errcode:"11103"})},l)}};void 0!==e.options.showSealsDlg&&!1===e.options.showSealsDlg?void 0===e.options.password?t.alert("\u672a\u8bbe\u7f6e\u7b7e\u7ae0\u5bc6\u7801\uff01"):void 0!=e.options.timestamp&&1==e.options.timestamp?h.ajax({url:e.options.serverUrl+"/key/getTimeStamp",data:{keysn:b.keyData.keysn},async:!1,success:function(a){a.result?c._onOk.call(this,b.keyData.seals[0],e.options.password,0,a.timestamp):c._onOk.call(this,b.keyData.seals[0],
e.options.password,0)},error:function(a){c._onOk.call(this,b.keyData.seals[0],e.options.password,0)}}):c._onOk.call(this,b.keyData.seals[0],e.options.password,0):this.showSealsDialog(c)},showSealsDialog:function(a){var b=this,c=b.keyData;null!=b.signdate&&(c.signDateIsCheck=b.signdate.ischeck);var d=[c],f=a._onOk;a={onShow:function(){var a=this,c=a.find(".kg-switcher");if(c.length){var d=new g.Switcher(c[0],b.switcher||{});h(".arrow-right").click(function(a){a.preventDefault();d.swipeNext()});h(".arrow-left").click(function(a){a.preventDefault();
d.swipePrev()});h(".kg-guide span").click(function(a){a.preventDefault();d.to(+this.getAttribute("index"))});b.switcher=d}a.find("#kg-dateSet").click(function(c){b.showFontDialog(a)});b.trigger("showSealsDialog",a);e.options.showNoPW||b.trigger("showSealsDialog_PW",a)},onOk:function(){var a=this,d=a.find("#kg-password"),k=d.val()||e.options.password;if(!k)return t.alert("\u8bf7\u8f93\u5165\u5bc6\u7801\uff01",function(){setTimeout(function(){d.focus()},100)}),!1;var g=a.find(".kg-wrapper .active");
a.isCheck=a.find("#kg-addDate").is(":checked");void 0!=e.options.timestamp&&1==e.options.timestamp?h.ajax({url:e.options.serverUrl+"/key/getTimeStamp",data:{keysn:b.keyData.keysn},async:!1,success:function(b){b.result?f.call(a,c.seals[g.attr("index")],k,g.attr("index"),b.timestamp):f.call(a,c.seals[g.attr("index")],k,g.attr("index"))},error:function(b){f.call(a,c.seals[g.attr("index")],k,g.attr("index"))}}):f.call(a,c.seals[g.attr("index")],k,g.attr("index"));return!1},content:function(){d.push(b.toBase64Img);
var a=[e.options.template.showSealsBtl].concat(d);e.options.showNoPW&&(a=[e.options.template.showSealsBtl_nopassword].concat(d));return g.template.apply(null,a)}};e.options.showNoPW?b.showDialog("showSealsBtl_nopassword",a):b.showDialog("showSealsBtl",a)},showFontDialog:function(a){var b=this,c=t.dafaultDate,d=null==b.signdate?{}:b.signdate,f=t.defaultFont,b=this,b=null==d.fontFormat?f.fontFormat:d.fontFormat,l=null==d.fontFamily?f.fontFamily:d.fontFamily,k=null==d.fontSize?f.fontSize:d.fontSize,
w=f.fontColor;null!=d.fontColor&&/^#([0-9a-fA-f]{6})$/.test(d.fontColor)&&(w=d.fontColor.toUpperCase());d=null==d.position?f.position:d.position;null!=a.fontSel&&(b=a.fontSel.fontFormat,l=a.fontSel.fontFamily,k=a.fontSel.fontSize,w=a.fontSel.fontColor,d=t.fontTemplate.position[a.fontSel.fontPositionIndex]);var z=this.getArrayPush(e.options.fontTemplate.fontFormat,b),m=[{fontFormat:this.getFormatDate(z,c),fontFamily:this.getArrayPush(e.options.fontTemplate.fontFamily,l),fontSize:this.getArrayPush(e.options.fontTemplate.fontSize,
k),fontColor:this.getArrayPush(e.options.fontTemplate.fontColor,w),fontPosition:e.options.fontTemplate.position,dFontFormat:n.Utils.formatDate(new Date(c),b),dFontFamily:l,dFontSize:k,dFontColor:w,dFontPosition:d}],B=t.showDialog("dateSetBtl",{title:"\u65e5\u671f\u8bbe\u7f6e",content:function(){var a=[e.options.template.dateSetBtl].concat(m);return g.template.apply(null,a)},onOk:function(){var b=this.find("#kg-fontFormat").get(0).selectedIndex;a.fontSel={fontFormat:z[b],fontFamily:this.find("#kg-fontFamily").val(),
fontSize:this.find("#kg-fontSize").val(),fontColor:n.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor")),fontPositionIndex:this.find("#kg-fontPosition").get(0).selectedIndex}}});B.find("#kg-select-color").on("click",function(){B.find(".kg-color-div").css("display","block");B.find("#kg-color-ul").css("display","block")});B.find("#kg-color-ul li a").click(function(){h("#kg-select-color").css("backgroundColor",h(this).css("backgroundColor"));B.find(".kg-color-div").css("display","none");
B.find("#kg-color-ul").css("display","none")});B.find(".kg-color-div").on("mouseover",function(a){this.contains(a.fromElement||a.relatedTarget)||h(this).show()});B.find(".kg-color-div").on("mouseout",function(a){this.contains(a.toElement||a.relatedTarget)||h(this).hide()});return B},getArrayPush:function(a,b){-1==jQuery.inArray(b,a)&&a.push(b);return a},getFormatDate:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=n.Utils.formatDate(new Date(b),a[d]);return c},genId:function(){var a=(new Date).getTime(),
b=""+Math.ceil((9301*(new Date).getTime()+49297)%233280/233280*99999),c=5-b.length;if(0<c)for(var d=0;d<c;d++)b="0"+b;return a+b},getSeal:function(a){return this.keyData.seals[a]},saveSignature:function(a,b,c,d){var f=this;void 0!=a&&void 0!=b&&void 0!=c&&(a=void 0!=e.options.cache_path&&null!=e.options.cache_path?{documentId:a,signatureId:b,signaturedata:c,cachepath:e.options.cache_path}:{documentId:a,signatureId:b,signaturedata:c,cachepath:""},n.surry(e.options.serverUrl).request("/signature/saveHtmlSignature",
a).ret(function(a){void 0!==d&&null!==d&&d.call(f,a)}).fail(function(a,b){alert(b)}))},removeSignature:function(a,b,c){var d=this;void 0!=a&&void 0!=b&&(a={documentId:a,signatureId:b},n.surry(e.options.serverUrl).request("/signature/reomveHtmlSignature",a).ret(function(a){void 0!==c&&null!==c&&c.call(d,a)}).fail(function(a,b){alert(b)}))},getSaveSignatures:function(a,b){void 0!=a&&n.surry(e.options.serverUrl).request("/signature/getHtmlSignature",{documentId:a}).ret(function(a){a.result&&b(a.sign)}).fail(function(a,
b){alert(b)})}});h.extend(e.options,{certType:"client",sealType:"client",clientUrl:"http://127.0.0.1:9581",moveable:!0,signable:!0,fontTemplate:t.fontTemplate,template:{showSealsBtl:t.template.sealTpl,showSealsBtl_nopassword:t.template.sealTpl_nopassword,signSignatureBtl:'<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="password" id="kg-password" class="form-control"></div> </div></div></div>',
revokeSignatureBtl:'<div id="kg-verifyPass" class="kg-dialog  kg-dialog-password"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u7b7e\u7ae0\uff1a</label><div class="kg-sm kg-sm-7"><p class="kg-form-static"><%this.signatureData.seal.signname%></p></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="password" id="kg-password" class="form-control"></div> </div></div></div>',
dateSetBtl:'<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u683c\u5f0f\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5b57\u4f53\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5c3a\u5bf8\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u989c\u8272\uff1a</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u4f4d\u7f6e\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>"><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div>'}});
e.list={};e.updateList=[];e.removeList=[];e.loadSignature=function(a,b,c){var d={};void 0==e.options.extra&&(e.options.extra={});d[a]=b;void 0!==s.extra&&null!==s.extra&&(e.options.extra[s.signatureid]=s.extra);u(d,c||function(a){a.verify()})};e.loadSignatures=function(a,b){var c={};void 0==e.options.extra&&(e.options.extra={});if(g.is("Array",a))for(var d=0;d<a.length;d++){var f=a[d];c[f.signatureid]=f.signatureData;void 0!==f.extra&&null!==f.extra&&(e.options.extra[f.signatureid]=f.extra)}else for(d in a)c[d]=
a[d];u(c,b||function(){e.verify()})};e.clearRPW=function(){delCookie("ksn");delCookie("pwd");delCookie("ck")};var D=new v("Signature");e.addLiseter=function(a,b){D.on(a,b)};e.verify=function(){var a=e.list,b=[];D.trigger("beforeVerify",d);for(var c in a){var d=a[c];d._verify()||b.push(d);D.trigger("eachVerify",d)}D.trigger("verify",d);return b};e.bind=function(a){g.extend(e.asyn,a)};e.show=function(){var a=e.list,b;for(b in a)a[b].show()};e.hide=function(){var a=e.list,b;for(b in a)a[b].hide()};e.AXI=
function(a,b,c,d){e.authcode=c;var f=n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319");""!==b&&""!==c?f.invoke(a,b,c).ret(function(a){void 0!==d&&null!==d&&d(a)}):null!==b&&""!==b?f.invoke(a,b).ret(function(a){void 0!==d&&null!==d&&d(a)}):f.invoke(a).ret(function(a){void 0!==d&&null!==d&&d(a)});return f};e.showAndHideBySignatureId=function(a,b){var c=e.list,d;for(d in c)0<=d.indexOf(a)&&(b?c[d].show():c[d].hide())};e.addIcon=function(a){var b=e.options.icons||
[];b.push(a);e.options.icons=b};e.create=function(a){var b=h.extend({},e.options,a);void 0!==a&&void 0!==a.imgtag&&(e.options.imgtag=a.imgtag);return new e._create(b)};h.extend(e.prototype,{saveSignatures:function(){},getSignatures:function(){}});v=function(a){var b=this;h.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};g.inherit(v,e.SealService);y=function(a){var b=this;h.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};g.inherit(y,e.CertService);h.extend(v.prototype,
{saveLog:function(a){var b=[];g.is("Object",a)?b.push(a):b=a;a=q({MSG:b});n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319").invoke("SetParamByName","SAVEMSG",a)},loadSeal:function(a){var b=this,c=a.successCall,d=a.errorCall;n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGGetKeyInfo").ret(function(a){if(a.result&&void 0!==e.options.imgtag&&null!==e.options.imgtag&&0!==e.options.imgtag){var f=[],
k;for(k in a.seals){var g=a.seals[k];void 0!==g&&parseInt(g.imgtag)==e.options.imgtag&&(f[f.length]=a.seals[k])}a.seals=f}a.result?c.call(b,a):d.call(b,a)})},verifyPwd:function(a){var b=this,c=a.successCall;n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGVerifyPin",a.pwd,a.keysn).ret(function(a){c.call(b,a)})}});h.extend(y.prototype,{verifySign:function(a){var b=this,c=a.successCall;n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1",
"4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGVerifySignMessage","123456",a.signdata,a.signeddata).ret(function(a){c.call(b,a.result||"-8"!==a.errcode?a:{result:!1})})},parseDate:function(a){var b=new Date;b.setFullYear(a.substring(0,4),+a.substring(4,6)-1,a.substring(6,8));b.setHours(a.substring(8,10),a.substring(10,12),a.substring(12,14),0);return b.getTime()},sign:function(a){for(var b=this,c=a.successCall,d=a.errorCall,f=a.signMeta,l=[],k=[],g=0;g<f.length;g++){var w=f[g];l.push(w.signdata);
k.push(""+w.signdata.length)}n.surry(e.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGCrySignMessage",a.password,l.join(";"),+k[0]).ret(function(a){a=h.extend({},a);a.result&&(a.certinfo.notAfter=b.parseDate(a.certinfo.notAfter),a.certinfo.notBefore=b.parseDate(a.certinfo.notBefore));c.call(b,a)}).fail(function(a,c){d.call(b,c);a(null)})}});e.addProvider("cert","client",y);e.addProvider("seal","client",v);v=function(a,b){var c=this;c.sData=b;h.each(a,
function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};g.inherit(v,e.SealService);var I=function(a,b){var c=this;c.sData=b;h.each(a,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};g.inherit(I,e.CertService);h.extend(v.prototype,{getSealsUrl:"/key/load",verifyPwdUrl:"/key/verify",saveLogUrl:"/signature/saveLog",saveLog:function(a){a=q(a);n.surry(this.serverUrl).request(this.saveLogUrl,{loginfo:a}).ret(function(a){a.result||e.prototype.warning.call(null,a)}).fail(function(a,
c){e.prototype.warning.call(null,c)})},loadSeal:function(a){var b=this,c=a.successCall,d=a.errorCall;a={usercode:b.usercode,keysn:b.keysn,signname:b.signname,authcode:b.authcode};n.surry(b.serverUrl).request(b.getSealsUrl,a).ret(function(a){if(a.result&&void 0!==e.options.imgtag&&null!==e.options.imgtag&&0!==e.options.imgtag){var f=[],k;for(k in a.seals){var g=a.seals[k];void 0!==g&&parseInt(g.imgtag)==e.options.imgtag&&(f[f.length]=a.seals[k])}a.seals=f}a.result?c.call(b,a):d.call(b,a)}).fail(function(a,
c){d.call(b,c)})},verifyPwd:function(a){var b=this,c=a.successCall,d=a.errorCall;a={usercode:void 0==b.sData?a.usercode:b.sData.usercode,keysn:void 0==b.sData?a.keysn:b.sData.keysn,password:a.pwd};n.surry(b.serverUrl).request(b.verifyPwdUrl,a).ret(function(a){c.call(b,a)}).fail(function(a,c){d.call(b,c)})}});h.extend(I.prototype,{signUrl:"/sign",verifySignUrl:"/sign/verify",verifySign:function(a){var b=this,c=b.sData,d=a.successCall,e=a.errorCall;n.surry(b.serverUrl).request(b.verifySignUrl,{certType:c.certType,
isUTF8:c.isUTF8,signsn:c.seal.signsn,html2sign:c.signMeta.html2sign,keysn:c.keysn,signsn:c.seal.signsn,signdata:a.signdata,signeddata:c.signMeta.signeddata,crtdata:c.signMeta.certinfo.crtdata}).ret(function(a){d.call(b,a)}).fail(function(a,c){e.call(b,c)})},sign:function(a){for(var b=this,c=a.signMeta,d=a.errorCall,e=a.successCall,l=[],k=0;k<c.length;k++){var g=c[k];l.push("$"+(g.hashAlg||b.hashAlg)+"|"+(g.encryptAlg||b.encryptAlg)+"$"+g.signdata)}a={keysn:a.keysn,password:a.password,signdata:l.join(";"),
signsn:a.signsn};n.surry(b.serverUrl).request(b.signUrl,a).ret(function(a){a.result&&(a.certinfo.algName=a.certinfo.algName.replace("with",""));e.call(b,a)}).fail(function(a,c){d.call(b,c)})}});e.addProvider("cert","server",I);e.addProvider("seal","server",v);e.alert=t.alert;var O=e.version={name:"1.0.20",code:100};m.Signature=e})(this,kinggrid,jQuery);
var CryptoJS=CryptoJS||function(m,n){var h={},q=h.lib={},u=q.Base=function(){function k(){}return{extend:function(g){k.prototype=this;var h=new k;g&&h.mixIn(g);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var k=this.extend();k.init.apply(k,arguments);return k},init:function(){},mixIn:function(k){for(var g in k)k.hasOwnProperty(g)&&(this[g]=k[g]);k.hasOwnProperty("toString")&&(this.toString=k.toString)},
clone:function(){return this.init.prototype.extend(this)}}}(),x=q.WordArray=u.extend({init:function(k,g){k=this.words=k||[];this.sigBytes=g!=n?g:4*k.length},toString:function(k){return(k||g).stringify(this)},concat:function(k){var g=this.words,h=k.words,n=this.sigBytes;k=k.sigBytes;this.clamp();if(n%4)for(var m=0;m<k;m++)g[n+m>>>2]|=(h[m>>>2]>>>24-m%4*8&255)<<24-(n+m)%4*8;else if(65535<h.length)for(m=0;m<k;m+=4)g[n+m>>>2]=h[m>>>2];else g.push.apply(g,h);this.sigBytes+=k;return this},clamp:function(){var k=
this.words,g=this.sigBytes;k[g>>>2]&=4294967295<<32-g%4*8;k.length=m.ceil(g/4)},clone:function(){var k=u.clone.call(this);k.words=this.words.slice(0);return k},random:function(k){for(var g=[],h=0;h<k;h+=4)g.push(4294967296*m.random()|0);return new x.init(g,k)}}),F=h.enc={},g=F.Hex={stringify:function(k){var g=k.words;k=k.sigBytes;for(var h=[],m=0;m<k;m++){var n=g[m>>>2]>>>24-m%4*8&255;h.push((n>>>4).toString(16));h.push((n&15).toString(16))}return h.join("")},parse:function(k){for(var g=k.length,
h=[],m=0;m<g;m+=2)h[m>>>3]|=parseInt(k.substr(m,2),16)<<24-m%8*4;return new x.init(h,g/2)}},E=F.Latin1={stringify:function(k){var g=k.words;k=k.sigBytes;for(var h=[],m=0;m<k;m++)h.push(String.fromCharCode(g[m>>>2]>>>24-m%4*8&255));return h.join("")},parse:function(k){for(var g=k.length,h=[],m=0;m<g;m++)h[m>>>2]|=(k.charCodeAt(m)&255)<<24-m%4*8;return new x.init(h,g)}},C=F.Utf8={stringify:function(k){try{return decodeURIComponent(escape(E.stringify(k)))}catch(w){throw Error("Malformed UTF-8 data");
}},parse:function(k){return E.parse(unescape(encodeURIComponent(k)))}},v=q.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new x.init;this._nDataBytes=0},_append:function(k){"string"==typeof k&&(k=C.parse(k));this._data.concat(k);this._nDataBytes+=k.sigBytes},_process:function(k){var g=this._data,h=g.words,n=g.sigBytes,v=this.blockSize,u=n/(4*v),u=k?m.ceil(u):m.max((u|0)-this._minBufferSize,0);k=u*v;n=m.min(4*k,n);if(k){for(var q=0;q<k;q+=v)this._doProcessBlock(h,q);q=h.splice(0,k);g.sigBytes-=
n}return new x.init(q,n)},clone:function(){var g=u.clone.call(this);g._data=this._data.clone();return g},_minBufferSize:0});q.Hasher=v.extend({cfg:u.extend(),init:function(g){this.cfg=this.cfg.extend(g);this.reset()},reset:function(){v.reset.call(this);this._doReset()},update:function(g){this._append(g);this._process();return this},finalize:function(g){g&&this._append(g);return this._doFinalize()},blockSize:16,_createHelper:function(g){return function(k,h){return(new g.init(h)).finalize(k)}},_createHmacHelper:function(g){return function(k,
h){return(new J.HMAC.init(g,h)).finalize(k)}}});var J=h.algo={};return h}(Math);
(function(){var m=CryptoJS,n=m.lib,h=n.WordArray,q=n.Hasher,u=[],n=m.algo.SHA1=q.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,m){for(var g=this._hash.words,n=g[0],q=g[1],v=g[2],x=g[3],k=g[4],w=0;80>w;w++){if(16>w)u[w]=h[m+w]|0;else{var z=u[w-3]^u[w-8]^u[w-14]^u[w-16];u[w]=z<<1|z>>>31}z=(n<<5|n>>>27)+k+u[w];z=20>w?z+((q&v|~q&x)+1518500249):40>w?z+((q^v^x)+1859775393):60>w?z+((q&v|q&x|v&x)-1894007588):z+((q^v^
x)-899497514);k=x;x=v;v=q<<30|q>>>2;q=n;n=z}g[0]=g[0]+n|0;g[1]=g[1]+q|0;g[2]=g[2]+v|0;g[3]=g[3]+x|0;g[4]=g[4]+k|0},_doFinalize:function(){var h=this._data,m=h.words,g=8*this._nDataBytes,n=8*h.sigBytes;m[n>>>5]|=128<<24-n%32;m[(n+64>>>9<<4)+14]=Math.floor(g/4294967296);m[(n+64>>>9<<4)+15]=g;h.sigBytes=4*m.length;this._process();return this._hash},clone:function(){var h=q.clone.call(this);h._hash=this._hash.clone();return h}});m.SHA1=q._createHelper(n);m.HmacSHA1=q._createHmacHelper(n)})(this);
// V1.0.0.280A    
//# sourceMappingURL=c:/signature.min.map
